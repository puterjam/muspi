# Muspi ğŸµ

> Muspi Entertainment with AI Agent - åŸºäºæ ‘è“æ´¾çš„æ™ºèƒ½éŸ³ä¹æ’­æ”¾å™¨

```
          .~~.   .~~.
         '. \ ' ' / .'
          .~ .~~~..~.          __  ___                     _
         : .~.'~'.~. :        /  |/  /__  __ _____ ____   (_)
        ~ (   ) (   ) ~      / /|_/ // / / // ___// __ \ / /
       ( : '~'.~.'~' : )    / /  / // /_/ /(__  )/ /_/ // /
        ~ .~ (   ) ~. ~    /_/  /_/ \__,_//____// .___//_/
         (  : '~' :  )                         /_/
          '~ .~~~. ~'      Created by PuterJam
              '~'
```

## é¡¹ç›®ç®€ä»‹

Muspi æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æ ‘è“æ´¾ä¸Šçš„æ™ºèƒ½éŸ³ä¹å¨±ä¹ç³»ç»Ÿï¼Œé›†æˆäº†å¤šç§éŸ³ä¹æ’­æ”¾æºå’Œ AI è¯­éŸ³åŠ©æ‰‹åŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸµ **å¤šéŸ³æºæ”¯æŒ**
  - Roon éŸ³ä¹æœåŠ¡é›†æˆ
  - AirPlay 2 æ— çº¿éŸ³é¢‘æµï¼ˆé€šè¿‡ shairport-syncï¼‰
  - CD æ’­æ”¾æ”¯æŒï¼ˆå¯é€‰ï¼‰
  - æµåª’ä½“æ’­æ”¾

- ğŸ¤– **AI åŠ©æ‰‹é›†æˆ**
  - å°æ™ºè¯­éŸ³åŠ©æ‰‹æ”¯æŒ
  - TTSï¼ˆæ–‡æœ¬è½¬è¯­éŸ³ï¼‰åŠŸèƒ½
  - MQTT é€šä¿¡

- ğŸ®**å†…ç½®å°æ¸¸æˆ**
  - å°æé¾™ï¼ˆå¯é€‰ï¼‰
  - lifeæ¸¸æˆï¼ˆå¯é€‰ï¼‰

## ç¡¬ä»¶è¦æ±‚

- æ ‘è“æ´¾ï¼ˆæ”¯æŒ GPIOã€SPIï¼‰
- SSD1305 OLED æ˜¾ç¤ºå±
- è¾“å…¥è®¾å¤‡ï¼ˆé”®ç›˜/æŒ‰é”®/è“ç‰™ï¼‰
- å¯é€‰ï¼šCD é©±åŠ¨å™¨
- å¯é€‰ï¼šéŸ³é¢‘è¾“å‡ºè®¾å¤‡ï¼ˆç”¨äº RoonBridgeï¼‰

## ç³»ç»Ÿè¦æ±‚

- æ ‘è“æ´¾ 2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨èæ ‘è“æ´¾ 4ï¼‰
- æ ‘è“æ´¾ OS 64ä½ï¼ˆDebian Trixie æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- Python 3.11+ï¼ˆå·²æµ‹è¯• Python 3.13ï¼‰
- å¯ç”¨çš„ SPI æ¥å£
- WiFi æˆ–æœ‰çº¿ç½‘ç»œè¿æ¥

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/puterjam/muspi.git
cd muspi
```

### 2. è¿è¡Œå®‰è£…è„šæœ¬

```bash
chmod +x install.sh
./install.sh
```

å®‰è£…è„šæœ¬æä¾›ä¸¤ç§æ¨¡å¼ï¼š
- **ç²¾ç®€å®‰è£…**ï¼šå¿«é€Ÿå®‰è£…ï¼ŒåŸºç¡€åŠŸèƒ½ï¼ˆçº¦ 5 åˆ†é’Ÿï¼‰
- **å®Œæ•´å®‰è£…**ï¼šåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼ˆçº¦ 30-60 åˆ†é’Ÿï¼Œéœ€ç¼–è¯‘ï¼‰

> æ³¨æ„ï¼šå®Œæ•´å®‰è£…éœ€è¦ç¼–è¯‘ shairport-sync ç­‰ç»„ä»¶ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´ã€‚

### 3. å¯ç”¨ç¡¬ä»¶æ¥å£

å¦‚æœ SPI æ¥å£æœªå¯ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ï¼š

```bash
sudo raspi-config
```

è¿›å…¥ `Interface Options`ï¼Œå¯ç”¨ï¼š
- SPI


## è¿è¡Œ

```bash
./venv/bin/python main.py
```

æˆ–è€…æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåè¿è¡Œï¼š

```bash
source venv/bin/activate
python main.py
```

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- **[æ’ä»¶å¼€å‘è§„èŒƒ](docs/plugins.md)** - æ’ä»¶å¼€å‘å®Œæ•´æŒ‡å—ã€API å‚è€ƒå’Œç¤ºä¾‹
- **[æŒ‰é”®æ˜ å°„é…ç½®](docs/keymap.md)** - æŒ‰é”®é…ç½®è¯´æ˜å’Œç¼–ç¨‹æ¥å£

## é¡¹ç›®ç»“æ„

```
muspi/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ drive/               # ç¡¬ä»¶é©±åŠ¨
â”‚   â”œâ”€â”€ SSD1305.py      # OLED æ˜¾ç¤ºå±é©±åŠ¨
â”‚   â””â”€â”€ config.py       # ç¡¬ä»¶é…ç½®
â”œâ”€â”€ screen/              # æ˜¾ç¤ºç®¡ç†
â”‚   â”œâ”€â”€ manager.py      # æ˜¾ç¤ºç®¡ç†å™¨
â”‚   â”œâ”€â”€ plugin.py       # æ’ä»¶ç®¡ç†å™¨
â”‚   â””â”€â”€ plugins/        # æ˜¾ç¤ºæ’ä»¶
â”œâ”€â”€ until/               # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ device/         # è®¾å¤‡ç®¡ç†
â”‚   â”œâ”€â”€ keymap.py       # æŒ‰é”®æ˜ å°„
â”‚   â””â”€â”€ log.py          # æ—¥å¿—å·¥å…·
â”œâ”€â”€ docs/                # æ–‡æ¡£
â”‚   â”œâ”€â”€ plugins.md      # æ’ä»¶å¼€å‘è§„èŒƒ
â”‚   â””â”€â”€ keymap.md       # æŒ‰é”®æ˜ å°„é…ç½®
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ keymap.json     # æŒ‰é”®é…ç½®
â”‚   â””â”€â”€ plugins.json    # æ’ä»¶é…ç½®
â”œâ”€â”€ requirements.txt     # Python ä¾èµ–
â”œâ”€â”€ install.sh           # å®‰è£…è„šæœ¬
â””â”€â”€ install_service.sh   # æœåŠ¡å®‰è£…è„šæœ¬
```

## æ’ä»¶å¼€å‘

Muspi æ”¯æŒæ’ä»¶åŒ–çš„æ˜¾ç¤ºç³»ç»Ÿï¼Œä½ å¯ä»¥å¼€å‘è‡ªå·±çš„æ’ä»¶æ¥æ‰©å±•åŠŸèƒ½ã€‚

### å¿«é€Ÿå¼€å§‹

1. **æŸ¥çœ‹æ’ä»¶å¼€å‘æ–‡æ¡£**: [docs/plugins.md](docs/plugins.md)
2. **å‚è€ƒç¤ºä¾‹æ’ä»¶**:
   - ç®€å•æ—¶é’Ÿ: [screen/plugins/clock.py](screen/plugins/clock.py)
   - æ¸¸æˆç¤ºä¾‹: [screen/plugins/life.py](screen/plugins/life.py)
   - CD æ’­æ”¾å™¨: [screen/plugins/cdplayer.py](screen/plugins/cdplayer.py)

### æ’ä»¶ç‰¹æ€§

- ğŸ¨ åŸºäº PIL çš„ç»˜å›¾ API
- âŒ¨ï¸ å®Œæ•´çš„æŒ‰é”®äº‹ä»¶å¤„ç†
- ğŸ”„ çµæ´»çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ“Š å¯è°ƒèŠ‚çš„å¸§ç‡æ§åˆ¶
- ğŸ¯ è‡ªåŠ¨æ¿€æ´»/åœç”¨æœºåˆ¶

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹ **[æ’ä»¶å¼€å‘è§„èŒƒ](docs/plugins.md)**

## æ›´æ–°æ—¥å¿—

### æœ€è¿‘æ›´æ–° (2025-11-21)

- âœ… **CD æ’­æ”¾å™¨ä¼˜åŒ–**
  - ä¿®å¤ mpv socket è¿æ¥é—®é¢˜ï¼ˆé¿å… socat è¿æ¥æ‹’ç»é”™è¯¯ï¼‰
  - ä¿®å¤é‡å¤æ’­æ”¾é—®é¢˜ï¼ˆé˜²æ­¢åœ¨ CD è¯»å–æ—¶é‡å¤å¯åŠ¨ï¼‰
  - ä¿®å¤é•¿æ—¶é—´ç©ºé—²å CD é‡è½½é—®é¢˜
  - æ”¹è¿›æ’­æ”¾çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†
  - æ·»åŠ  ALSA éŸ³é¢‘è¾“å‡ºæ”¯æŒ

- âœ… **éŸ³é‡æ¡æ˜¾ç¤ºä¼˜åŒ–**
  - æ”¹è¿›éŸ³é‡æ¡çš„è§†è§‰è¡¨ç°
  - ä¿®å¤ Overlay å±‚å¸§ç‡é—®é¢˜

- âœ… **é”®ç›˜æ˜ å°„ç³»ç»Ÿ**
  - åˆ†ç¦» keymap é…ç½®åˆ°ç‹¬ç«‹æ–‡ä»¶ (`config/keymap.json`)
  - æ”¯æŒè‡ªå®šä¹‰æŒ‰é”®æ˜ å°„
  - æ”¹è¿›è¾“å…¥è®¾å¤‡çƒ­æ’æ‹”æ”¯æŒ

### å†å²æ›´æ–°

- âœ… **æ–°å¢ AirPlay 2 æ”¯æŒ**ï¼ˆé€šè¿‡ shairport-syncï¼‰
- âœ… **WiFi é˜²æ‰çº¿ä¼˜åŒ–**ï¼ˆè‡ªåŠ¨ç¦ç”¨çœç”µæ¨¡å¼ + è¿æ¥ä¿æ´»ï¼‰
- âœ… **å®Œå–„å®‰è£…è„šæœ¬**ï¼ˆè‡ªåŠ¨ç¼–è¯‘ä¾èµ–ã€é…ç½®æœåŠ¡ï¼‰
- âœ… è¿ç§»åˆ° Python 3.13
- âœ… ç”¨ `watchdog` æ›¿æ¢ `pyinotify`ï¼ˆè§£å†³ asyncore å…¼å®¹æ€§é—®é¢˜ï¼‰
- âœ… æ·»åŠ  Overlay å±‚æ”¯æŒ
- âœ… ä½¿ç”¨ cd-discid æ›¿ä»£ libdiscidï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- âœ… ä¼˜åŒ– Roon å’Œå°æ™ºçš„é‡è¿æœºåˆ¶
- âœ… å…¼å®¹ TTS çš„ stop çŠ¶æ€

è¯¦ç»†æ›´æ–°å†å²è¯·æŸ¥çœ‹ `git log`ã€‚

## æ•…éšœæ’é™¤

### shairport-sync ç›¸å…³é—®é¢˜

**æ£€æŸ¥ shairport-sync çŠ¶æ€ï¼š**
```bash
sudo systemctl status shairport-sync
```

**é‡å¯ shairport-syncï¼š**
```bash
sudo systemctl restart shairport-sync
```

**æŸ¥çœ‹ shairport-sync æ—¥å¿—ï¼š**
```bash
journalctl -u shairport-sync -f
```

**æµ‹è¯• AirPlay è¿æ¥ï¼š**
åœ¨ iOS è®¾å¤‡ä¸Šæ‰“å¼€æ§åˆ¶ä¸­å¿ƒï¼Œç‚¹å‡» AirPlay å›¾æ ‡ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä½ çš„æ ‘è“æ´¾è®¾å¤‡åç§°ã€‚

**é…ç½®éŸ³é¢‘è¾“å‡ºï¼š**
ç¼–è¾‘é…ç½®æ–‡ä»¶ `/etc/shairport-sync.conf`ï¼Œæ ¹æ®å®é™…ç¡¬ä»¶è°ƒæ•´éŸ³é¢‘è¾“å‡ºè®¾ç½®ã€‚

### RoonBridge è¿æ¥é—®é¢˜

**æ‰‹åŠ¨å®‰è£… RoonBridgeï¼ˆ64ä½ç³»ç»Ÿï¼‰ï¼š**
```bash
curl -O https://download.roonlabs.net/builds/roonbridge-installer-linuxarmv8.sh
chmod +x roonbridge-installer-linuxarmv8.sh
sudo ./roonbridge-installer-linuxarmv8.sh
```

**32ä½ç³»ç»Ÿè¯·ä½¿ç”¨ï¼š**
```bash
curl -O https://download.roonlabs.net/builds/roonbridge-installer-linuxarmv7hf.sh
chmod +x roonbridge-installer-linuxarmv7hf.sh
sudo ./roonbridge-installer-linuxarmv7hf.sh
```

ç¡®ä¿æ ‘è“æ´¾å’Œ Roon Core åœ¨åŒä¸€ç½‘ç»œä¸­ï¼Œå¹¶åœ¨ Roon åº”ç”¨çš„ Settings â†’ Audio ä¸­å¯ä»¥çœ‹åˆ° RoonBridge è®¾å¤‡ã€‚

## è®¸å¯è¯

MIT License

## ä½œè€…

PuterJam

---

**Enjoy your music with Muspi! ğŸµ**
